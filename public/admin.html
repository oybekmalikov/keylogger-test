<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>Viewer</title>
</head>
<body>
	<h3>Admin - viewing live screen</h3>
	<video id="remote" autoplay playsinline style="width:800px;"></video>
	<script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
	<script>
		const socket = io.connect('/', { transports: ['websocket'] });
		const roomId = 'dlp-room';
		let pc;

		socket.emit('join-room', roomId);

		socket.on('offer', async ({ sdp, from }) => {
			pc = new RTCPeerConnection({
				iceServers: [{ urls: 'stun:stun.l.google.com:19302' }],
			});

			pc.ontrack = e => {
				document.getElementById('remote').srcObject = e.streams[0];
			};

			pc.onicecandidate = e => {
				if (e.candidate) {
					socket.emit('ice-candidate', { roomId, candidate: e.candidate });
				}
			};

			await pc.setRemoteDescription(new RTCSessionDescription(sdp));
			const answer = await pc.createAnswer();
			await pc.setLocalDescription(answer);
			socket.emit('answer', { roomId, sdp: answer });
		});

		socket.on('ice-candidate', async ({ candidate }) => {
			if (pc) await pc.addIceCandidate(candidate);
		});
	</script>
</body>
</html>
